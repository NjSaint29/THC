<div class="row">
    <div class="col-md-6">
        <h6><i class="fas fa-user"></i> Patient Information</h6>
        <table class="table table-sm">
            <tr>
                <td><strong>Patient ID:</strong></td>
                <td>{{ patient.patient_id }}</td>
            </tr>
            <tr>
                <td><strong>Name:</strong></td>
                <td>{{ patient.get_full_name }}</td>
            </tr>
            <tr>
                <td><strong>Age/Gender:</strong></td>
                <td>{{ patient.age }} years, {{ patient.get_gender_display }}</td>
            </tr>
            <tr>
                <td><strong>Phone:</strong></td>
                <td>{{ patient.phone_number|default:"Not provided" }}</td>
            </tr>
            <tr>
                <td><strong>Campaign:</strong></td>
                <td>{{ patient.campaign.name }}</td>
            </tr>
        </table>
    </div>
    <div class="col-md-6">
        <h6><i class="fas fa-stethoscope"></i> Consultation Information</h6>
        <table class="table table-sm">
            <tr>
                <td><strong>Doctor:</strong></td>
                <td>{{ consultation.doctor.get_full_name }}</td>
            </tr>
            <tr>
                <td><strong>Date:</strong></td>
                <td>{{ consultation.consultation_date|date:"M d, Y g:i A" }}</td>
            </tr>
            <tr>
                <td><strong>Diagnosis:</strong></td>
                <td>{{ consultation.working_diagnosis|default:"Not specified" }}</td>
            </tr>
            <tr>
                <td><strong>Status:</strong></td>
                <td>
                    <span class="badge bg-info">{{ consultation.get_status_display }}</span>
                </td>
            </tr>
        </table>
    </div>
</div>

<hr>

<div class="row">
    <div class="col-12">
        <h6><i class="fas fa-pills"></i> Prescription Details</h6>
        <div class="card">
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <p><strong>Medication:</strong> {{ prescription.get_drug_name }}</p>
                        {% if prescription.get_drug_category != "Custom Medication" %}
                            <p><strong>Category:</strong> {{ prescription.get_drug_category|title }}</p>
                        {% endif %}
                        {% if prescription.get_drug_strength %}
                            <p><strong>Strength:</strong> {{ prescription.get_drug_strength }}</p>
                        {% endif %}
                        <p><strong>Route:</strong> {{ prescription.get_route_display }}</p>
                        <p><strong>Pharmacy Status:</strong> 
                            {% if prescription.pharmacy_status == 'pending_review' %}
                                <span class="badge bg-warning">{{ prescription.get_pharmacy_status_display }}</span>
                            {% elif prescription.pharmacy_status == 'details_needed' %}
                                <span class="badge bg-danger">{{ prescription.get_pharmacy_status_display }}</span>
                            {% elif prescription.pharmacy_status == 'ready_to_dispense' %}
                                <span class="badge bg-success">{{ prescription.get_pharmacy_status_display }}</span>
                            {% elif prescription.pharmacy_status == 'dispensed' %}
                                <span class="badge bg-info">{{ prescription.get_pharmacy_status_display }}</span>
                            {% else %}
                                <span class="badge bg-secondary">{{ prescription.get_pharmacy_status_display }}</span>
                            {% endif %}
                        </p>
                    </div>
                    <div class="col-md-6">
                        <p><strong>Dosage:</strong> 
                            {% if prescription.dosage %}
                                {{ prescription.dosage }}
                            {% else %}
                                <span class="text-danger">Not specified</span>
                            {% endif %}
                        </p>
                        <p><strong>Frequency:</strong> 
                            {% if prescription.frequency %}
                                {{ prescription.frequency }}
                            {% else %}
                                <span class="text-danger">Not specified</span>
                            {% endif %}
                        </p>
                        <p><strong>Duration:</strong> 
                            {% if prescription.duration %}
                                {{ prescription.duration }}
                            {% else %}
                                <span class="text-danger">Not specified</span>
                            {% endif %}
                        </p>
                        <p><strong>Quantity:</strong> {{ prescription.quantity|default:"Not specified" }}</p>
                        <p><strong>Refills:</strong> {{ prescription.refills }}</p>
                    </div>
                </div>

                {% if prescription.indication %}
                    <div class="mt-3">
                        <strong>Indication:</strong>
                        <p>{{ prescription.indication }}</p>
                    </div>
                {% endif %}

                {% if prescription.instructions %}
                    <div class="mt-3">
                        <strong>Special Instructions:</strong>
                        <p>{{ prescription.instructions|linebreaks }}</p>
                    </div>
                {% endif %}

                {% if prescription.notes %}
                    <div class="mt-3">
                        <strong>Pharmacy Notes:</strong>
                        <p>{{ prescription.notes|linebreaks }}</p>
                    </div>
                {% endif %}

                {% if prescription.dispensed_by %}
                    <div class="mt-3">
                        <strong>Dispensing Information:</strong>
                        <p>
                            Dispensed by: {{ prescription.dispensed_by.get_full_name }}<br>
                            Date: {{ prescription.dispensed_date|date:"M d, Y g:i A" }}<br>
                            Quantity Dispensed: {{ prescription.dispensed_quantity|default:"Not recorded" }}
                        </p>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<div class="modal-footer">
    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
    {% if prescription.needs_pharmacy_review %}
        <a href="{% url 'pharmacy:prescription_complete' prescription.pk %}" class="btn btn-warning">
            <i class="fas fa-edit"></i> Complete Details
        </a>
    {% elif prescription.is_ready_to_dispense %}
        <button type="button" class="btn btn-success" onclick="dispenseMedication({{ prescription.id }})">
            <i class="fas fa-hand-holding-medical"></i> Dispense
        </button>
    {% endif %}
</div>
