<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ title }}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .registration-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        .registration-card {
            background: white;
            border-radius: 15px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            max-width: 800px;
            width: 100%;
        }
        .registration-header {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        .registration-body {
            padding: 40px;
        }
        .role-info {
            background: #f8f9fa;
            border-left: 4px solid #007bff;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
        }
        .btn-register {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            border: none;
            padding: 12px 30px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .btn-register:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.4);
        }
        .form-control:focus {
            border-color: #4CAF50;
            box-shadow: 0 0 0 0.2rem rgba(76, 175, 80, 0.25);
        }
        .form-select:focus {
            border-color: #4CAF50;
            box-shadow: 0 0 0 0.2rem rgba(76, 175, 80, 0.25);
        }
    </style>
</head>
<body>
    <div class="registration-container">
        <div class="registration-card">
            <div class="registration-header">
                <h1><i class="fas fa-user-plus"></i> Join Tiko Health Campaign</h1>
                <p class="mb-0">Register as a Staff Member</p>
            </div>
            
            <div class="registration-body">
                <!-- Messages -->
                {% if messages %}
                    {% for message in messages %}
                        <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                            {{ message }}
                            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                        </div>
                    {% endfor %}
                {% endif %}

                <!-- Welcome Message -->
                <div class="alert alert-info">
                    <h5><i class="fas fa-info-circle"></i> Welcome to Tiko Health Campaign!</h5>
                    <p class="mb-0">Please fill out this form to register as a staff member. After registration, you'll be able to log in and access your role-specific dashboard.</p>
                </div>

                <form method="post" id="registrationForm">
                    {% csrf_token %}
                    
                    <div class="row">
                        <!-- Personal Information -->
                        <div class="col-md-6">
                            <h5 class="text-primary mb-3"><i class="fas fa-user"></i> Personal Information</h5>
                            
                            <div class="mb-3">
                                <label for="{{ form.first_name.id_for_label }}" class="form-label">
                                    First Name <span class="text-danger">*</span>
                                </label>
                                {{ form.first_name }}
                                {% if form.first_name.errors %}
                                    <div class="text-danger small">{{ form.first_name.errors.0 }}</div>
                                {% endif %}
                            </div>

                            <div class="mb-3">
                                <label for="{{ form.last_name.id_for_label }}" class="form-label">
                                    Last Name <span class="text-danger">*</span>
                                </label>
                                {{ form.last_name }}
                                {% if form.last_name.errors %}
                                    <div class="text-danger small">{{ form.last_name.errors.0 }}</div>
                                {% endif %}
                            </div>

                            <div class="mb-3">
                                <label for="{{ form.email.id_for_label }}" class="form-label">
                                    Email Address <span class="text-danger">*</span>
                                </label>
                                {{ form.email }}
                                {% if form.email.errors %}
                                    <div class="text-danger small">{{ form.email.errors.0 }}</div>
                                {% endif %}
                            </div>

                            <div class="mb-3">
                                <label for="{{ form.phone_number.id_for_label }}" class="form-label">
                                    Phone Number
                                </label>
                                {{ form.phone_number }}
                                {% if form.phone_number.errors %}
                                    <div class="text-danger small">{{ form.phone_number.errors.0 }}</div>
                                {% endif %}
                            </div>
                        </div>

                        <!-- Account Information -->
                        <div class="col-md-6">
                            <h5 class="text-primary mb-3"><i class="fas fa-key"></i> Account Information</h5>
                            
                            <div class="mb-3">
                                <label for="{{ form.username.id_for_label }}" class="form-label">
                                    Username <span class="text-danger">*</span>
                                </label>
                                {{ form.username }}
                                {% if form.username.errors %}
                                    <div class="text-danger small">{{ form.username.errors.0 }}</div>
                                {% endif %}
                                <small class="text-muted">This will be used to log into the system</small>
                            </div>

                            <div class="mb-3">
                                <label for="{{ form.password1.id_for_label }}" class="form-label">
                                    Password <span class="text-danger">*</span>
                                </label>
                                {{ form.password1 }}
                                {% if form.password1.errors %}
                                    <div class="text-danger small">{{ form.password1.errors.0 }}</div>
                                {% endif %}
                            </div>

                            <div class="mb-3">
                                <label for="{{ form.password2.id_for_label }}" class="form-label">
                                    Confirm Password <span class="text-danger">*</span>
                                </label>
                                {{ form.password2 }}
                                {% if form.password2.errors %}
                                    <div class="text-danger small">{{ form.password2.errors.0 }}</div>
                                {% endif %}
                            </div>
                        </div>
                    </div>

                    <!-- Role Selection -->
                    <div class="row mt-4">
                        <div class="col-12">
                            <h5 class="text-primary mb-3"><i class="fas fa-user-tag"></i> Role Selection</h5>
                            
                            <div class="mb-3">
                                <label for="{{ form.role.id_for_label }}" class="form-label">
                                    Select Your Role <span class="text-danger">*</span>
                                </label>
                                {{ form.role }}
                                {% if form.role.errors %}
                                    <div class="text-danger small">{{ form.role.errors.0 }}</div>
                                {% endif %}
                                <small class="text-muted">{{ form.role.help_text }}</small>
                            </div>

                            <!-- Role Information Display -->
                            <div id="roleInfo" class="role-info" style="display: none;">
                                <h6 id="roleTitle" class="text-primary"></h6>
                                <p id="roleDescription"></p>
                                <div id="rolePermissions"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Form Errors -->
                    {% if form.non_field_errors %}
                        <div class="alert alert-danger mt-3">
                            {{ form.non_field_errors }}
                        </div>
                    {% endif %}

                    <!-- Submit Button -->
                    <div class="text-center mt-4">
                        <button type="submit" class="btn btn-primary btn-register btn-lg">
                            <i class="fas fa-user-plus"></i> Register as Staff Member
                        </button>
                    </div>
                </form>

                <!-- Login Link -->
                <div class="text-center mt-4">
                    <p class="text-muted">
                        Already have an account? 
                        <a href="{% url 'accounts:login' %}" class="text-decoration-none">
                            <i class="fas fa-sign-in-alt"></i> Login Here
                        </a>
                    </p>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Role information mapping
        const roleInfo = {
            'registration_clerk': {
                title: '1️⃣ Registration Clerk',
                description: 'Handles Section A: DEMOGRAPHIC AND BIOGRAPHIC DATA',
                permissions: [
                    'View list of active campaigns',
                    'Register new patients with auto-generated Patient ID',
                    'View and edit patient demographics',
                    'Cannot view clinical parameters, consultations, lab results, or prescriptions'
                ]
            },
            'vitals_clerk': {
                title: '2️⃣ Vitals Clerk',
                description: 'Handles Section B: CLINICAL PARAMETERS',
                permissions: [
                    'Search patients by ID or name',
                    'View demographics (read-only)',
                    'Enter/update clinical parameters (weight, temperature, BP, HR, glucose, height, LMP)',
                    'Cannot edit demographics, consultations, lab results, or prescriptions'
                ]
            },
            'doctor': {
                title: '3️⃣ Doctor',
                description: 'Handles Sections C & E: MEDICAL CONSULTATION and PRESCRIPTIONS',
                permissions: [
                    'View full patient record (demographics + vitals + lab results)',
                    'Enter/update consultation details and diagnosis',
                    'Order lab tests and write prescriptions',
                    'Cannot edit demographics, vitals, or lab results'
                ]
            },
            'lab_technician': {
                title: '4️⃣ Lab Technician',
                description: 'Handles Section D: LABORATORY TEST RESULTS',
                permissions: [
                    'Search patients and view demographics, vitals, and requested tests',
                    'Enter/update lab test results and conclusions',
                    'Mark critical values for immediate notification',
                    'Cannot edit demographics, vitals, consultations, or prescriptions'
                ]
            }
        };

        // Update role information when role is selected
        document.getElementById('id_role').addEventListener('change', function() {
            const selectedRole = this.value;
            const infoDiv = document.getElementById('roleInfo');
            
            if (selectedRole && roleInfo[selectedRole]) {
                const info = roleInfo[selectedRole];
                document.getElementById('roleTitle').textContent = info.title;
                document.getElementById('roleDescription').textContent = info.description;
                
                const permissionsHtml = '<strong>Responsibilities:</strong><ul>' + 
                    info.permissions.map(p => `<li>${p}</li>`).join('') + 
                    '</ul>';
                document.getElementById('rolePermissions').innerHTML = permissionsHtml;
                
                infoDiv.style.display = 'block';
            } else {
                infoDiv.style.display = 'none';
            }
        });

        // Form validation
        document.getElementById('registrationForm').addEventListener('submit', function(e) {
            const password1 = document.getElementById('id_password1').value;
            const password2 = document.getElementById('id_password2').value;
            
            if (password1 !== password2) {
                e.preventDefault();
                alert('Passwords do not match!');
                return false;
            }
            
            const role = document.getElementById('id_role').value;
            if (!role) {
                e.preventDefault();
                alert('Please select your role!');
                return false;
            }
        });

        // Auto-focus first field
        document.getElementById('id_first_name').focus();
    </script>
</body>
</html>
